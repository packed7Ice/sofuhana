<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <style>
    /* FOUC防止用の最小限スタイル。外部CSS読み込み前でも画面切替状態を維持する */
    .screen { display: none; }
    .screen.active { display: flex; }
    #app { transition: opacity .25s ease; }
    body[data-boot="preload"] #app {
      opacity: 0;
      visibility: hidden;
    }
    body[data-boot="ready"] #app {
      opacity: 1;
      visibility: visible;
    }
  </style>
  <noscript>
    <style>
      body[data-boot="preload"] #app {
        opacity: 1 !important;
        visibility: visible !important;
      }
    </style>
  </noscript>
  <title>そふ花</title>
  <link rel="stylesheet" href="style.css"/>
  <link rel="stylesheet" href="help.css"/>
  <!-- Site icons and social previews -->
  <link rel="icon" href="./images/Title_transparency.png" type="image/png" />
  <link rel="apple-touch-icon" href="./images/Title_transparency.png" />
  <meta property="og:image" content="./images/Title_transparency.png" />
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:image" content="./images/Title_transparency.png" />
</head>
<body data-boot="preload">
  <div id="fit">
    <div id="app">
      <!-- タイトル -->
      <div id="title-screen" class="screen active">
        <h1 class="game-logo"></h1>
        <button id="start-game-button" class="action-button">ゲームスタート</button>
        <div class="title-secondary-actions">
          <button id="help-button" class="action-button">ヘルプ</button>
          <button id="report-button" class="action-button">バグ・要望報告</button>
        </div>
        <p class="credits">©Yorikawa Aise, nu_tsumi, cit_sofume</p>
      </div>

      <!-- 回戦選択 -->
      <div id="rounds-screen" class="screen">
        <h2 class="scene-title">回戦数を選んでください</h2>
        <div class="round-buttons-container">
          <button class="round-button action-button" data-rounds="3">3回戦</button>
          <button class="round-button action-button" data-rounds="6">6回戦</button>
          <button class="round-button action-button" data-rounds="12">12回戦</button>
        </div>
      </div>

      <!-- ゲーム -->
      <div id="game-screen" class="screen">
        <!-- HUD（上部バー） -->
        <div id="hud">
          <div id="game-info">
            <span id="current-round" class="game-stat">第1回戦</span> |
            あなたの点数: <span id="player-score" class="game-stat">0</span>点 |
            相手の点数: <span id="cpu-score" class="game-stat">0</span>点
          </div>
          <div class="hud-buttons">
            <button id="help-button-game" class="action-button">ヘルプ</button>
            <button id="report-button-game" class="action-button">バグ・要望報告</button>
          </div>
        </div>

        <!-- ツールチップ（JSがbody直下にも生成するが、初期描画用） -->
        <div id="card-info-box" style="display:none;">
          <p id="card-info-month"></p>
          <p id="card-info-name"></p>
          <p id="card-info-type"></p>
        </div>

        <div class="game-container-inner">
          <div class="main-game-area">
            <div class="hand-area player-cpu-area">
              <h2 class="area-title">相手の手札</h2>
              <div id="cpu-hand-area" class="hand"></div>
            </div>

            <div class="board-and-deck">
              <div id="draw-preview-area" class="draw-preview" aria-label="山札から引いた札">
                <img id="draw-preview-image" alt="引いた札" />
                <div class="draw-label">引いた札</div>
              </div>
              <div id="board-area" class="board"></div>
              <div id="deck-area" class="deck" aria-label="山札">
                <img id="deck-image" src="./images/back.png" alt="山札" />
                <div id="deck-count">24</div>
              </div>
            </div>

            <div class="player-controls-container">
              <div class="hand-area player-area">
                <h2 class="area-title">あなたの手札</h2>
                <div id="player-hand-area" class="hand"></div>
              </div>
              <div id="action-buttons" class="action-buttons-container">
                <button id="koikoi-button" class="action-button">こいこい</button>
                <button id="shobu-button" class="action-button">勝負</button>
              </div>
            </div>
          </div>

          <div class="captured-container">
            <div class="captured-player">
              <h3 class="area-title">あなたの持ち札</h3>
              <div id="player-captured-area" class="captured-cards-container">
                <div id="player-light-area" class="captured-row"></div>
                <div id="player-tane-area" class="captured-row"></div>
                <div id="player-tan-area" class="captured-row"></div>
                <div id="player-kasu-area" class="captured-row"></div>
              </div>
            </div>
            <div class="captured-cpu">
              <h3 class="area-title">相手の持ち札</h3>
              <div id="cpu-captured-area" class="captured-cards-container">
                <div id="cpu-light-area" class="captured-row"></div>
                <div id="cpu-tane-area" class="captured-row"></div>
                <div id="cpu-tan-area" class="captured-row"></div>
                <div id="cpu-kasu-area" class="captured-row"></div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- リザルト -->
    <div id="result-screen" class="screen">
      <h2 id="result-message" class="scene-title"></h2>
      <div class="result-info">
        <p>最終得点</p>
        <p>あなた: <span id="final-player-score">0</span>点</p>
        <p>相手: <span id="final-cpu-score">0</span>点</p>
      </div>
      <div class="result-actions">
        <button id="restart-button" class="action-button">もう一度プレイ</button>
        <button id="return-to-title-button" class="action-button">タイトルに戻る</button>
      </div>
    </div>
  </div>

  <!-- ヘルプモーダル -->
  <div id="help-modal" role="dialog" aria-modal="true" aria-labelledby="help-title">
    <div class="modal-content">
      <h2 id="help-title">ヘルプ：花札「こいこい」</h2>

      <h3>基本の流れ</h3>
      <ol>
        <li>場札8枚、自分と相手に各8枚配り、残りは山札。</li>
        <li>自分の番：手札1枚を出す。同じ「月」の場札があれば取り、なければ場に残す。</li>
        <li>続けて山札1枚をめくり、同じ月があれば取り、なければ場に置く。</li>
        <li>役ができたら「勝負」か、続けて狙う「こいこい」を選ぶ。</li>
        <li>どちらも手札が0になったら<strong>流れ</strong>（点数なし）。次の先手は据え置き。</li>
      </ol>

      <h3>各月の札</h3>
      <div id="help-months" class="months-grid" aria-label="各月に対応する札の一覧"></div>

      <h3>役の例</h3>
      <div id="yaku-examples" class="yaku-examples" aria-label="役の例のサンプル画像一覧"></div>

      <p class="help-note">
        ※ 詳細は
        <a href="https://www.nintendo.com/jp/others/hanafuda_kabufuda/howtoplay/koikoi/index.html" target="_blank" rel="noopener noreferrer">
        こいこい｜花札の歴史・遊びかた｜花札・株札｜任天堂
        </a>
        を参照してください。バリエーションにより点数・細則が異なる場合があります。
      </p>

      <div class="help-modal-footer">
        <span class="sofume-logo" aria-hidden="true"></span>
        <button id="help-close" class="action-button">閉じる</button>
      </div>
    </div>
  </div>

  <div id="report-destination-modal" role="dialog" aria-modal="true" aria-labelledby="report-destination-title" aria-hidden="true">
    <div class="modal-content">
      <h2 id="report-destination-title">バグ・要望報告</h2>
      <p class="report-destination-message">
        報告方法を選択してください。Google フォームで送信する際は注意書きをご確認ください。
      </p>
      <div class="report-destination-actions">
        <button id="report-select-google" class="action-button">Google フォーム</button>
        <button id="report-select-github" class="action-button">GitHub</button>
      </div>
      <button id="report-destination-close" class="action-button tertiary">閉じる</button>
    </div>
  </div>

  <div id="report-confirm-modal" role="dialog" aria-modal="true" aria-labelledby="report-confirm-title" aria-hidden="true">
    <div class="modal-content">
      <h2 id="report-confirm-title">バグ・要望報告</h2>
      <p class="report-confirm-message">
        Google フォームへアクセスします。Google アカウントへのログインが必要ですが移動しますか？
      </p>
      <div class="report-confirm-actions">
        <button id="report-confirm-no" class="action-button">いいえ</button>
        <button id="report-confirm-yes" class="action-button">はい</button>
      </div>
    </div>
  </div>
  <script type="module" src="./script.js"></script>
</body>
</html>
